<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://jnnrphexgnqfrguuvpcw.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_eqpEBptiUc85ICVGIx65vA_nZfQg9-l";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let questions = [];
let currentIndex = 0;
let answers = {};
let lang = "en";

const mockId = localStorage.getItem("mock_id");

async function loadQuestions() {

  if(!mockId){
    alert("Mock not selected");
    window.location.href = "temp_degree_list.html";
    return;
  }

  const { data, error } = await supabase
    .from("temp_questions")
    .select("*")
    .eq("mock_id", mockId)
    .order("id", { ascending: true });

  if(error){
    console.error(error);
    alert("Error loading questions");
    return;
  }

  questions = data;
  renderQuestion();
}

function renderQuestion(){

  if(!questions.length){
    document.getElementById("questionBox").innerHTML = 
      "<h3>No Questions Found</h3>";
    return;
  }

  const q = questions[currentIndex];

  document.getElementById("qCount").innerText =
    `Question ${currentIndex+1} / ${questions.length}`;

  document.getElementById("qText").innerText =
    lang === "en" ? q.question_en : q.question_ml;

  const options = lang === "en" ? q.options_en : q.options_ml;

  const optDiv = document.getElementById("options");
  optDiv.innerHTML = "";

  options.forEach((opt,i)=>{
    const div = document.createElement("div");
    div.className = "option";
    div.innerText = opt;

    div.onclick = ()=>{
      answers[currentIndex] = i;
      renderQuestion();
    };

    if(answers[currentIndex] === i){
      div.classList.add("selected");
    }

    optDiv.appendChild(div);
  });
}

function nextQ(){
  if(currentIndex < questions.length-1){
    currentIndex++;
    renderQuestion();
  }
}

function prevQ(){
  if(currentIndex > 0){
    currentIndex--;
    renderQuestion();
  }
}

function toggleLang(){
  lang = lang === "en" ? "ml" : "en";
  renderQuestion();
}

function submitExam(){
  let score = 0;

  questions.forEach((q,i)=>{
    if(answers[i] === q.correct_index){
      score++;
    }
  });

  localStorage.setItem("temp_score", score);
  localStorage.setItem("temp_total", questions.length);

  window.location.href = "temp_result.html";
}

loadQuestions();
</script>

