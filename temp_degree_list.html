<!DOCTYPE html>
<html>
<head>
  <title>Degree Mock Tests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="temp_style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="card">
  <h2>ðŸŽ“ Degree Level Mock Tests</h2>

  <div class="option" onclick="startExam(1)">Mock Test 1</div>
  <div class="option" onclick="startExam(2)">Mock Test 2</div>
  <div class="option" onclick="startExam(3)">Mock Test 3</div>

  <br>
  <button onclick="goBack()">â¬… Back</button>
</div>

<script>

/* ===========================
   SUPABASE
===========================*/
const supabaseClient = window.supabase.createClient(
  "https://jnnrphexgnqfrguuvpcw.supabase.co",
  "sb_publishable_eqpEBptiUc85ICVGIx65vA_nZfQg9-l"
);

/* ===========================
   SESSION CHECK
===========================*/
const userName = localStorage.getItem("temp_name");

if(!userName){
  alert("Session expired. Login again.");
  window.location.href = "temp_login.html";
}

/* ===========================
   CONSTANT LEVEL
===========================*/
const LEVEL = "degree";

/* ===========================
   START EXAM
===========================*/
async function startExam(mockNumber){

  try{

    /* ðŸ”¥ SAVE SESSION FIRST */
    localStorage.setItem("mock_level", LEVEL);
    localStorage.setItem("mock_number", mockNumber);

    console.log("SESSION SET:", LEVEL, mockNumber);

    /* ðŸ”’ CHECK ATTEMPT */
    const { data, error } = await supabaseClient
      .from("temp_results")
      .select("id")
      .eq("user_name", userName)
      .eq("level", LEVEL)
      .eq("mock_number", mockNumber);

    if(error){
      console.error(error);
      alert("Error checking attempt");
      return;
    }

    /* ðŸ”’ ALREADY ATTEMPTED */
    if(data.length > 0){

      localStorage.setItem("exam_locked","true");
      localStorage.setItem("review_mode","false");

      window.location.href = "temp_result.html";
      return;
    }

    /* ðŸš€ ALLOW EXAM */
    localStorage.setItem("exam_locked","false");
    localStorage.removeItem("review_mode");

    window.location.href = "temp_exam.html";

  }catch(err){
    console.error("Unexpected Error:", err);
    alert("Something went wrong");
  }
}

/* ===========================
   BACK
===========================*/
function goBack(){
  window.location.href = "temp_dashboard.html";
}

</script>

</body>
</html>
