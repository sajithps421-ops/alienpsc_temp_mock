<!DOCTYPE html>
<html>
<head>
  <title>Degree Mock Tests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="temp_style.css">

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="card">
  <h2>ðŸŽ“ Degree Level Mock Tests</h2>

  <div class="option" onclick="startExam(1)">Mock Test 1</div>
  <div class="option" onclick="startExam(2)">Mock Test 2</div>
  <div class="option" onclick="startExam(3)">Mock Test 3</div>

  <br>
  <button onclick="goBack()">â¬… Back</button>
</div>

<script>

/* ---------- SUPABASE INIT ---------- */
const SUPABASE_URL = "https://jnnrphexgnqfrguuvpcw.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_eqpEBptiUc85ICVGIx65vA_nZfQg9-l";

const supabaseClient = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* ---------- SESSION CHECK ---------- */
const userName = localStorage.getItem("temp_name");

if(!userName){
  window.location.href = "temp_login.html";
}

/* ---------- CONSTANT LEVEL ---------- */
const LEVEL = "degree";

/* ---------- START EXAM ---------- */
async function startExam(mockNumber){

  try {

    // Save level + mock number
    localStorage.setItem("mock_level", LEVEL);
    localStorage.setItem("mock_number", mockNumber);

    /* ðŸ”’ Check if already attempted */
    const { data, error } = await supabaseClient
      .from("temp_results")
      .select("id")
      .eq("user_name", userName)
      .eq("level", LEVEL)
      .eq("mock_number", mockNumber);

    if(error){
      alert("Error checking attempt");
      console.error(error);
      return;
    }

    /* âœ… If already attempted â†’ lock exam */
    if(data.length > 0){

      localStorage.setItem("exam_locked", "true");
      window.location.href = "temp_result.html";
      return;
    }

    /* ðŸš€ Allow exam */
    localStorage.setItem("exam_locked", "false");
    window.location.href = "temp_exam.html";

  } catch(err){
    console.error("Unexpected Error:", err);
  }
}

/* ---------- BACK ---------- */
function goBack(){
  window.location.href = "temp_dashboard.html";
}

</script>

</body>
</html>
